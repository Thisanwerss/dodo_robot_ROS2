# Processing Node

The Processing Node is responsible for processing and validating control commands before sending them to the robot's motors. It combines inputs from multiple sources, applies motion constraints, and generates safe motor commands.

## Features

- Combines command inputs from reinforcement learning and USB controller
- Enforces motion constraints to ensure safe robot operation
- Applies motion limits to prevent hardware damage
- Acts as an intermediary between high-level control and low-level motor commands
- Configurable motion constraints and update rate

## Topics

### Subscribed Topics

- `/rl_actions` (sensor_msgs/JointState)
  - Joint actions generated by the reinforcement learning (RL) model
  - Contains target positions, velocities, and/or efforts for each joint
  - Serves as the primary source of robot motion in autonomous mode

- `/usb_commands` (std_msgs/Int32)
  - Command signals from the USB controller
  - Integer values represent different command types (e.g., 1=FORWARD, 2=BACKWARD)
  - Used for manual control and adjustments to the robot position

- `/aligned_sensor_data` (dodo_msgs/AlignedSensorData)
  - Combined sensor data from multiple sensors with synchronized timestamps
  - Used to make contextual decisions about motion processing

### Published Topics

- `/processed_commands` (sensor_msgs/JointState)
  - Final processed commands to be sent to the motor controllers
  - Contains validated and constrained joint positions, velocities, and efforts
  - In dummy mode: Generates simple test patterns with proper constraint validation

## Parameters

- `command_rate` (int, default: 100)
  - Frequency (in Hz) at which commands are processed and published
  - Controls the responsiveness of the robot to input commands

- `motion_constraints` (string, default: JSON string with constraints for each joint)
  - Motion constraints for each joint in JSON format
  - Contains min_position and max_position values to limit joint movement
  - Example format: `{"joint1": {"min_position": -1.57, "max_position": 1.57}, ...}`

## Functions

### ProcessingNode Class Functions

- `rlActionsCallback`: Processes incoming reinforcement learning actions
- `usbCommandsCallback`: Processes incoming USB controller commands
- `alignedSensorDataCallback`: Processes incoming sensor data
- `processCommands`: Main function that combines inputs and generates commands
- `combineCommands`: Combines commands from different sources into a single command
- `applyMotionConstraints`: Applies motion constraints to ensure safe operation

### Function Relationship

```
main()
└── ProcessingNode
    ├── Constructor
    │   └── Get parameters
    ├── rlActionsCallback() ← /rl_actions topic
    ├── usbCommandsCallback() ← /usb_commands topic
    ├── alignedSensorDataCallback() ← /aligned_sensor_data topic
    └── processCommands() [Timer callback]
        ├── combineCommands()
        │   └── Process inputs from RL and USB controller
        ├── applyMotionConstraints()
        │   └── Apply joint position limits
        └── Publish to /processed_commands topic
```